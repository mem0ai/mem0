# 记忆提取逻辑说明

## 概述

Mem0的记忆提取逻辑针对不同场景优化了记忆的管理方式，根据`user_id`和`agent_id`的存在情况自动调整不同角色消息的权重，确保最相关的信息被优先记忆和检索。

## 工作原理

### 1. 上下文感知的角色权重

系统根据当前上下文类型（由ID参数决定）自动调整记忆提取时对不同角色消息的权重：

- **用户上下文**（有`user_id`但没有`agent_id`）：
  - 用户消息权重更高（默认为1.0）
  - 助手消息权重较低（默认为0.7）

- **代理上下文**（存在`agent_id`）：
  - 助手消息权重更高（默认为1.0）
  - 用户消息权重较低（默认为0.7）

### 2. 重要信息识别

除了基于角色和上下文的权重外，系统还能识别包含重要个人信息或偏好的消息，无论权重如何，确保这些信息被记忆。系统通过检查以下关键词识别重要记忆：

- 个人偏好：如"我喜欢"、"我不喜欢"、"I like"、"I don't like"等
- 个人信息：如"我是"、"我的"、"I am"、"my"等
- 个人需求：如"我需要"、"我想"、"I need"、"I want"等

### 3. 记忆排序与优先级

提取的记忆按照以下优先级排序：

1. 重要性（是否包含关键词）
2. 权重值（角色在当前上下文的权重）

这确保了最重要和最相关的信息优先被处理和记忆。

## 配置选项

记忆提取逻辑的行为可以通过配置进行调整：

```python
config = {
    "extraction": {
        "role_weights": {
            "user": {"user_id_context": 1.0, "agent_id_context": 0.7},
            "assistant": {"user_id_context": 0.7, "agent_id_context": 1.0}
        },
        "important_keywords": [
            "我喜欢", "我不喜欢", "我的", "我是", "我想", "我需要", "我必须",
            "I like", "I don't like", "my", "I am", "I want", "I need", "I must"
        ]
    }
}
```

## 优势

1. **上下文感知**：系统能根据使用场景自动调整记忆策略
2. **个性化增强**：更好地捕获和保留用户的个人偏好和信息
3. **效率提升**：通过优先处理高价值信息，减少噪音和无关信息的记忆
4. **记忆质量提升**：记忆内容更加集中于重要信息，提高后续互动的相关性
5. **灵活配置**：可以根据需要调整角色权重和关键词列表

## 技术实现

记忆提取逻辑通过`_extract_memories`方法实现，该方法在记忆创建过程中被调用，对原始消息进行过滤和优先级排序，然后交给后续的事实提取和嵌入处理。 